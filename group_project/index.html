<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Machine Failure Prediction - Autoencoder Model</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .btn {
            display: inline-block;
            background: var(--secondary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background 0.3s ease;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #d68910;
        }
        
        .file-upload {
            margin-top: 10px;
            padding: 15px;
            border: 2px dashed #ddd;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .file-upload:hover {
            border-color: var(--secondary);
        }
        
        .prediction-result {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            background: var(--light);
        }
        
        .prediction-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .low-risk {
            color: var(--success);
        }
        
        .medium-risk {
            color: var(--warning);
        }
        
        .high-risk {
            color: var(--danger);
        }
        
        .gauge-container {
            position: relative;
            width: 200px;
            height: 100px;
            margin: 0 auto;
            overflow: hidden;
        }
        
        .gauge {
            width: 200px;
            height: 100px;
            border-radius: 100px 100px 0 0;
            position: relative;
            overflow: hidden;
            background: conic-gradient(
                var(--success) 0% 33%,
                var(--warning) 33% 66%,
                var(--danger) 66% 100%
            );
        }
        
        .gauge-inner {
            position: absolute;
            width: 160px;
            height: 80px;
            background: white;
            border-radius: 80px 80px 0 0;
            bottom: 0;
            left: 20px;
        }
        
        .gauge-needle {
            position: absolute;
            width: 4px;
            height: 90px;
            background: var(--dark);
            bottom: 0;
            left: 50%;
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 1s ease;
            z-index: 10;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric {
            text-align: center;
            padding: 15px;
            border-radius: 5px;
            background: var(--light);
        }
        
        .metric-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .feature-importance {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }
        
        .feature-bar {
            display: flex;
            align-items: center;
        }
        
        .feature-name {
            width: 150px;
            font-size: 0.9rem;
        }
        
        .feature-value {
            flex-grow: 1;
            height: 20px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .feature-fill {
            height: 100%;
            background: var(--secondary);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .confusion-matrix {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: #ddd;
            border: 1px solid #ddd;
            margin-top: 20px;
        }
        
        .matrix-cell {
            background: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .matrix-header {
            background: var(--light);
            font-weight: bold;
        }
        
        .true-positive {
            background: rgba(46, 204, 113, 0.2);
        }
        
        .false-positive {
            background: rgba(231, 76, 60, 0.2);
        }
        
        .false-negative {
            background: rgba(243, 156, 18, 0.2);
        }
        
        .true-negative {
            background: rgba(52, 152, 219, 0.2);
        }
        
        .ml-pipeline {
            margin-top: 30px;
        }
        
        .pipeline-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .pipeline-step {
            text-align: center;
            flex: 1;
            padding: 15px;
            background: white;
            border-radius: 10px;
            margin: 0 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-width: 150px;
            margin-bottom: 10px;
        }
        
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            background: var(--secondary);
            color: white;
            border-radius: 50%;
            line-height: 30px;
            margin-bottom: 10px;
        }
        
        .step-active .step-number {
            background: var(--success);
        }
        
        .data-preview {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: var(--light);
            font-weight: 600;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-complete {
            background: rgba(46, 204, 113, 0.2);
            color: var(--success);
        }
        
        .status-pending {
            background: rgba(241, 196, 15, 0.2);
            color: var(--warning);
        }
        
        .status-error {
            background: rgba(231, 76, 60, 0.2);
            color: var(--danger);
        }
        
        .dataset-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .info-card {
            background: var(--light);
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        
        .info-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .info-label {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .stats-table {
            width: 100%;
            margin-top: 15px;
        }
        
        .stats-table th, .stats-table td {
            padding: 8px;
            text-align: center;
        }
        
        .correlation-matrix {
            width: 100%;
            margin-top: 15px;
        }
        
        .correlation-matrix th, .correlation-matrix td {
            padding: 8px;
            text-align: center;
        }
        
        .high-correlation {
            background-color: rgba(231, 76, 60, 0.2);
        }
        
        .medium-correlation {
            background-color: rgba(243, 156, 18, 0.2);
        }
        
        .low-correlation {
            background-color: rgba(46, 204, 113, 0.2);
        }
        
        .chart-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-item {
            flex: 1;
            min-width: 300px;
        }
        
        .chart-item-full {
            flex: 100%;
        }
        
        .eda-section {
            margin-bottom: 30px;
        }
        
        .eda-section h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }
        
        .csv-format-info {
            background: var(--light);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .missing-values-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .missing-values-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .preview-table {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        
        .data-split-info {
            background: var(--light);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .missing-values-table {
            width: 100%;
            margin: 15px 0;
        }
        
        .missing-values-table th {
            background: var(--light);
            padding: 10px;
            text-align: left;
        }
        
        .missing-values-table td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .missing-count {
            font-weight: bold;
            color: var(--danger);
        }
        
        .cluster-info {
            background: var(--light);
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .cluster-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .cluster-stat {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .cluster-color {
            display: inline-block;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .correlation-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .correlation-table th, .correlation-table td {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
        }
        
        .correlation-table th {
            background: var(--light);
            font-weight: bold;
        }
        
        .cluster-scatter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .cluster-scatter-item {
            flex: 1;
            min-width: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Machine Failure Prediction System</h1>
            <p class="subtitle">Autoencoder-Based Anomaly Detection with K-Prototypes Clustering</p>
        </header>
        
        <div class="ml-pipeline">
            <h2>Machine Learning Pipeline</h2>
            <div class="pipeline-steps">
                <div class="pipeline-step step-active" id="step1">
                    <div class="step-number">1</div>
                    <h3>Data Upload</h3>
                    <p>Upload CSV dataset</p>
                    <div class="status-badge status-pending">Pending</div>
                </div>
                <div class="pipeline-step" id="step2">
                    <div class="step-number">2</div>
                    <h3>Dataset Info</h3>
                    <p>Analyze characteristics</p>
                    <div class="status-badge status-pending">Pending</div>
                </div>
                <div class="pipeline-step" id="step3">
                    <div class="step-number">3</div>
                    <h3>EDA & Clustering</h3>
                    <p>Explore & cluster data</p>
                    <div class="status-badge status-pending">Pending</div>
                </div>
                <div class="pipeline-step" id="step4">
                    <div class="step-number">4</div>
                    <h3>Preprocessing</h3>
                    <p>Prepare for modeling</p>
                    <div class="status-badge status-pending">Pending</div>
                </div>
                <div class="pipeline-step" id="step5">
                    <div class="step-number">5</div>
                    <h3>Autoencoder</h3>
                    <p>Train deep model</p>
                    <div class="status-badge status-pending">Pending</div>
                </div>
                <div class="pipeline-step" id="step6">
                    <div class="step-number">6</div>
                    <h3>Evaluation</h3>
                    <p>Test performance</p>
                    <div class="status-badge status-pending">Pending</div>
                </div>
            </div>
            
            <div class="card">
                <div class="tabs">
                    <div class="tab active" data-tab="data-upload">Data Upload</div>
                    <div class="tab" data-tab="dataset-info">Dataset Info</div>
                    <div class="tab" data-tab="eda">EDA & Clustering</div>
                    <div class="tab" data-tab="preprocessing">Preprocessing</div>
                    <div class="tab" data-tab="training">Autoencoder Training</div>
                    <div class="tab" data-tab="evaluation">Evaluation</div>
                </div>
                
                <div class="tab-content active" id="data-upload">
                    <h3>Upload Your Dataset</h3>
                    <p>Upload a CSV file containing machine data with the required columns.</p>
                    
                    <div class="csv-format-info">
                        <h4>Expected Columns:</h4>
                        <ul>
                            <li><strong>Type</strong> - Product type (L, M, H)</li>
                            <li><strong>Air temperature [K]</strong> - Ambient temperature</li>
                            <li><strong>Process temperature [K]</strong> - Operating temperature</li>
                            <li><strong>Rotational speed [rpm]</strong> - Machine speed</li>
                            <li><strong>Torque [Nm]</strong> - Force measurement</li>
                            <li><strong>Tool wear [min]</strong> - Tool usage time</li>
                            <li><strong>Machine failure</strong> - Target variable (0/1)</li>
                        </ul>
                    </div>
                    
                    <div class="file-upload" id="file-upload-area">
                        <p>üìÅ Drag & drop your CSV file here or click to browse</p>
                        <input type="file" id="file-input" accept=".csv" style="display: none;">
                        <button type="button" class="btn btn-success" id="upload-btn">Choose File</button>
                    </div>
                    
                    <div id="upload-status" style="margin-top: 15px;"></div>
                    
                    <div class="data-preview" id="data-preview" style="display: none;">
                        <h4>Data Preview (First 10 rows)</h4>
                        <table id="data-table">
                            <thead id="data-table-head"></thead>
                            <tbody id="data-table-body"></tbody>
                        </table>
                    </div>
                    
                    <button class="btn btn-warning" id="analyze-btn" style="margin-top: 15px; display: none;">Analyze Dataset</button>
                </div>
                
                <div class="tab-content" id="dataset-info">
                    <h3>Dataset Information</h3>
                    <div id="dataset-summary">
                        <p>Please upload a dataset to see information</p>
                    </div>
                    
                    <div class="dataset-info" id="dataset-stats" style="display: none;">
                        <div class="info-card">
                            <div class="info-label">Total Records</div>
                            <div class="info-value" id="total-records">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Features</div>
                            <div class="info-value" id="total-features">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Failure Rate</div>
                            <div class="info-value" id="failure-rate">0%</div>
                        </div>
                    </div>
                    
                    <div id="missing-values-section" style="display: none;"></div>
                    
                    <button class="btn btn-warning" id="eda-btn" style="margin-top: 15px; display: none;">Perform EDA & Clustering</button>
                </div>
                
                <div class="tab-content" id="eda">
                    <h3>Exploratory Data Analysis & K-Prototypes Clustering</h3>
                    <div id="eda-content">
                        <p>Please analyze the dataset first</p>
                    </div>
                    
                    <button class="btn btn-warning" id="preprocess-btn" style="margin-top: 15px; display: none;">Preprocess Data</button>
                </div>
                
                <div class="tab-content" id="preprocessing">
                    <h3>Data Preprocessing</h3>
                    <div id="preprocessing-content">
                        <p>Please complete EDA first</p>
                    </div>
                    
                    <div id="data-split-info" style="display: none;"></div>
                    
                    <button class="btn btn-warning" id="train-btn" style="margin-top: 15px; display: none;">Train Autoencoder</button>
                </div>
                
                <div class="tab-content" id="training">
                    <h3>Autoencoder Model Training</h3>
                    <div id="training-content">
                        <p>Please preprocess data first</p>
                    </div>
                    
                    <button class="btn btn-warning" id="evaluate-btn" style="margin-top: 15px; display: none;">Evaluate Model</button>
                </div>
                
                <div class="tab-content" id="evaluation">
                    <h3>Model Evaluation</h3>
                    <div id="evaluation-content">
                        <p>Please train the model first</p>
                    </div>
                    
                    <button class="btn btn-success" id="prediction-ready-btn" style="margin-top: 15px; display: none;">Ready for Predictions</button>
                </div>
            </div>
        </div>
        
        <div class="dashboard">
            <div class="card">
                <h2>Machine Parameters</h2>
                <form id="prediction-form">
                    <div class="form-group">
                        <label for="product-type">Product Type</label>
                        <select id="product-type" required>
                            <option value="">Select Type</option>
                            <option value="L">Low (L)</option>
                            <option value="M">Medium (M)</option>
                            <option value="H">High (H)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="air-temperature">Air Temperature (K)</label>
                        <input type="number" id="air-temperature" min="295" max="305" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="process-temperature">Process Temperature (K)</label>
                        <input type="number" id="process-temperature" min="305" max="315" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="rotational-speed">Rotational Speed (rpm)</label>
                        <input type="number" id="rotational-speed" min="1168" max="2886" step="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="torque">Torque (Nm)</label>
                        <input type="number" id="torque" min="3.8" max="76.6" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="tool-wear">Tool Wear (min)</label>
                        <input type="number" id="tool-wear" min="0" max="253" step="1" required>
                    </div>
                    
                    <button type="submit" class="btn" id="predict-btn" disabled>üîÆ Predict Failure Risk</button>
                    <button type="button" class="btn btn-danger" id="reset-btn">üîÑ Reset</button>
                </form>
            </div>
            
            <div class="card">
                <h2>Failure Risk Prediction</h2>
                <div class="prediction-result">
                    <p>Failure Probability</p>
                    <div class="gauge-container">
                        <div class="gauge"></div>
                        <div class="gauge-inner"></div>
                        <div class="gauge-needle" id="gauge-needle"></div>
                    </div>
                    <div class="prediction-value" id="prediction-value">0%</div>
                    <p id="risk-level">Model Not Ready</p>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-label">Accuracy</div>
                        <div class="metric-value" id="accuracy-display">0%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Precision</div>
                        <div class="metric-value" id="precision-display">0%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Recall</div>
                        <div class="metric-value" id="recall-display">0%</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">F1-Score</div>
                        <div class="metric-value" id="f1-score-display">0%</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="tabs">
                <div class="tab active" data-tab="feature-importance">Feature Importance</div>
                <div class="tab" data-tab="performance">Performance</div>
                <div class="tab" data-tab="history">History</div>
            </div>
            
            <div class="tab-content active" id="feature-importance">
                <h2>Feature Importance Analysis</h2>
                <div class="feature-importance">
                    <div class="feature-bar">
                        <div class="feature-name">Torque</div>
                        <div class="feature-value"><div class="feature-fill" style="width: 0%"></div></div>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-name">Tool Wear</div>
                        <div class="feature-value"><div class="feature-fill" style="width: 0%"></div></div>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-name">Rotational Speed</div>
                        <div class="feature-value"><div class="feature-fill" style="width: 0%"></div></div>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-name">Process Temp</div>
                        <div class="feature-value"><div class="feature-fill" style="width: 0%"></div></div>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-name">Air Temp</div>
                        <div class="feature-value"><div class="feature-fill" style="width: 0%"></div></div>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-name">Product Type</div>
                        <div class="feature-value"><div class="feature-fill" style="width: 0%"></div></div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="performance">
                <h2>Model Performance</h2>
                <div class="confusion-matrix">
                    <div class="matrix-cell matrix-header"></div>
                    <div class="matrix-cell matrix-header">Predicted: No Failure</div>
                    <div class="matrix-cell matrix-header">Predicted: Failure</div>
                    <div class="matrix-cell matrix-header">Actual: No Failure</div>
                    <div class="matrix-cell true-negative" id="true-negative">0</div>
                    <div class="matrix-cell false-positive" id="false-positive">0</div>
                    <div class="matrix-cell matrix-header">Actual: Failure</div>
                    <div class="matrix-cell false-negative" id="false-negative">0</div>
                    <div class="matrix-cell true-positive" id="true-positive">0</div>
                </div>
                <div class="chart-container">
                    <canvas id="performance-chart"></canvas>
                </div>
            </div>
            
            <div class="tab-content" id="history">
                <h2>Prediction History</h2>
                <div class="preview-table">
                    <table id="history-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Type</th>
                                <th>Air Temp</th>
                                <th>Process Temp</th>
                                <th>Speed</th>
                                <th>Torque</th>
                                <th>Tool Wear</th>
                                <th>Risk</th>
                                <th>Prediction</th>
                            </tr>
                        </thead>
                        <tbody id="history-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Machine Failure Prediction System | Autoencoder Model with Mixed Data Clustering | ¬© 2024</p>
        </footer>
    </div>

    <script>
        // Global variables
        let uploadedData = null;
        let currentStep = 1;
        let modelReady = false;
        let predictionHistory = [];
        let numericFeatures = ['Air temperature [K]', 'Process temperature [K]', 'Rotational speed [rpm]', 'Torque [Nm]', 'Tool wear [min]'];
        let categoricalFeatures = ['Type'];
        let targetVariable = 'Machine failure';
        let clusterResults = null;
        
        // DOM Elements
        const fileInput = document.getElementById('file-input');
        const uploadBtn = document.getElementById('upload-btn');
        const fileUploadArea = document.getElementById('file-upload-area');
        const uploadStatus = document.getElementById('upload-status');
        const dataPreview = document.getElementById('data-preview');
        const analyzeBtn = document.getElementById('analyze-btn');
        const edaBtn = document.getElementById('eda-btn');
        const preprocessBtn = document.getElementById('preprocess-btn');
        const trainBtn = document.getElementById('train-btn');
        const evaluateBtn = document.getElementById('evaluate-btn');
        const predictionReadyBtn = document.getElementById('prediction-ready-btn');
        const predictBtn = document.getElementById('predict-btn');
        const resetBtn = document.getElementById('reset-btn');
        const predictionForm = document.getElementById('prediction-form');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            initializeTabs();
        });
        
        function initializeEventListeners() {
            // File upload events
            uploadBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileUpload);
            
            // Drag and drop for file upload
            fileUploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUploadArea.style.borderColor = '#3498db';
            });
            
            fileUploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                fileUploadArea.style.borderColor = '#ddd';
            });
            
            fileUploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUploadArea.style.borderColor = '#ddd';
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    handleFileUpload();
                }
            });
            
            // Pipeline buttons
            analyzeBtn.addEventListener('click', analyzeDataset);
            edaBtn.addEventListener('click', performEDA);
            preprocessBtn.addEventListener('click', preprocessData);
            trainBtn.addEventListener('click', trainAutoencoder);
            evaluateBtn.addEventListener('click', evaluateModel);
            predictionReadyBtn.addEventListener('click', () => {
                modelReady = true;
                predictBtn.disabled = false;
                updateStep(6, 'complete');
                alert('Model is ready for predictions!');
            });
            
            // Prediction form
            predictionForm.addEventListener('submit', handlePrediction);
            resetBtn.addEventListener('click', resetForm);
            
            // Initialize gauge
            updateGauge(0);
        }
        
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Pipeline tabs
            const pipelineTabs = document.querySelectorAll('.tab[data-tab]');
            pipelineTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }
        
        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabId).classList.add('active');
            
            // Activate selected tab
            document.querySelector(`.tab[data-tab="${tabId}"]`).classList.add('active');
        }
        
        function handleFileUpload() {
            const file = fileInput.files[0];
            if (!file) return;
            
            if (!file.name.toLowerCase().endsWith('.csv')) {
                showStatus('Please upload a CSV file', 'error');
                return;
            }
            
            showStatus('Processing file...', 'info');
            
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.errors.length > 0) {
                        showStatus('Error parsing CSV file', 'error');
                        console.error('CSV Errors:', results.errors);
                        return;
                    }
                    
                    uploadedData = results.data;
                    showStatus(`File uploaded successfully: ${uploadedData.length} rows`, 'success');
                    updateStep(1, 'complete');
                    showDataPreview();
                    analyzeBtn.style.display = 'inline-block';
                },
                error: function(error) {
                    showStatus('Error reading file', 'error');
                    console.error('File Error:', error);
                }
            });
        }
        
        function showStatus(message, type = 'info') {
            const colors = {
                info: '#3498db',
                success: '#2ecc71',
                error: '#e74c3c',
                warning: '#f39c12'
            };
            
            uploadStatus.innerHTML = `
                <div style="padding: 10px; background: ${colors[type]}20; color: ${colors[type]}; 
                          border-radius: 5px; border-left: 4px solid ${colors[type]}">
                    ${message}
                </div>
            `;
        }
        
        function showDataPreview() {
            if (!uploadedData || uploadedData.length === 0) return;
            
            const previewData = uploadedData.slice(0, 10);
            const headers = Object.keys(uploadedData[0]);
            
            // Create table header
            let thead = '<tr>';
            headers.forEach(header => {
                thead += `<th>${header}</th>`;
            });
            thead += '</tr>';
            document.getElementById('data-table-head').innerHTML = thead;
            
            // Create table body
            let tbody = '';
            previewData.forEach(row => {
                tbody += '<tr>';
                headers.forEach(header => {
                    tbody += `<td>${row[header] !== null && row[header] !== undefined ? row[header] : ''}</td>`;
                });
                tbody += '</tr>';
            });
            document.getElementById('data-table-body').innerHTML = tbody;
            
            dataPreview.style.display = 'block';
        }
        
        function updateStep(step, status) {
            // Update current step
            currentStep = step;
            
            // Update pipeline steps
            for (let i = 1; i <= 6; i++) {
                const stepElement = document.getElementById(`step${i}`);
                const badge = stepElement.querySelector('.status-badge');
                
                if (i < step) {
                    stepElement.classList.add('step-active');
                    badge.textContent = 'Complete';
                    badge.className = 'status-badge status-complete';
                } else if (i === step) {
                    stepElement.classList.add('step-active');
                    badge.textContent = status === 'complete' ? 'Complete' : 'In Progress';
                    badge.className = `status-badge ${status === 'complete' ? 'status-complete' : 'status-pending'}`;
                } else {
                    stepElement.classList.remove('step-active');
                    badge.textContent = 'Pending';
                    badge.className = 'status-badge status-pending';
                }
            }
        }
        
        function analyzeDataset() {
            if (!uploadedData || uploadedData.length === 0) {
                alert('Please upload data first');
                return;
            }
            
            updateStep(2, 'complete');
            switchTab('dataset-info');
            
            // Calculate dataset statistics
            const totalRecords = uploadedData.length;
            
            // Count failures
            let failureCount = 0;
            let failureColumnName = 'Machine failure';
            
            // Find the failure column name
            const firstRow = uploadedData[0];
            for (let key in firstRow) {
                if (key.toLowerCase().includes('failure') || key.toLowerCase().includes('target')) {
                    failureColumnName = key;
                    break;
                }
            }
            
            failureCount = uploadedData.filter(row => row[failureColumnName] === 1).length;
            
            const failureRate = ((failureCount / totalRecords) * 100).toFixed(2);
            
            // Display statistics
            document.getElementById('total-records').textContent = totalRecords.toLocaleString();
            document.getElementById('total-features').textContent = numericFeatures.length + categoricalFeatures.length;
            document.getElementById('failure-rate').textContent = `${failureRate}%`;
            document.getElementById('dataset-stats').style.display = 'grid';
            
            // Check for missing values
            checkMissingValues();
            
            // Update dataset summary
            document.getElementById('dataset-summary').innerHTML = `
                <p>The dataset contains <strong>${totalRecords}</strong> records with <strong>${numericFeatures.length + categoricalFeatures.length}</strong> features.</p>
                <p>The failure rate is <strong>${failureRate}%</strong> (${failureCount} failure cases).</p>
                <p><strong>Numeric Features (5):</strong> ${numericFeatures.join(', ')}</p>
                <p><strong>Categorical Features (1):</strong> ${categoricalFeatures.join(', ')}</p>
                <p><strong>Target Variable:</strong> ${failureColumnName}</p>
            `;
            
            edaBtn.style.display = 'inline-block';
        }
        
        function checkMissingValues() {
            if (!uploadedData || uploadedData.length === 0) return;
            
            const allFeatures = [...numericFeatures, ...categoricalFeatures];
            let missingValuesFound = false;
            let missingValuesHtml = '<h4>Missing Values Analysis</h4>';
            
            allFeatures.forEach(feature => {
                const missingCount = uploadedData.filter(row => 
                    row[feature] === null || row[feature] === undefined || row[feature] === ''
                ).length;
                
                if (missingCount > 0) {
                    missingValuesFound = true;
                    missingValuesHtml += `
                        <div style="margin: 5px 0;">
                            <strong>${feature}:</strong> ${missingCount} missing values (${((missingCount/uploadedData.length)*100).toFixed(2)}%)
                        </div>
                    `;
                }
            });
            
            if (missingValuesFound) {
                missingValuesHtml = `
                    <div class="missing-values-section">
                        ${missingValuesHtml}
                        <div class="missing-values-options">
                            <button class="btn btn-warning" onclick="handleMissingValues('mean')">Fill with Mean/Median/Mode</button>
                            <button class="btn btn-warning" onclick="handleMissingValues('remove')">Remove Rows</button>
                        </div>
                    </div>
                `;
            } else {
                missingValuesHtml = '<p style="color: var(--success);">‚úì No missing values found in the dataset.</p>';
            }
            
            document.getElementById('missing-values-section').innerHTML = missingValuesHtml;
            document.getElementById('missing-values-section').style.display = 'block';
        }
        
        function handleMissingValues(strategy) {
            alert(`Missing values handling strategy: ${strategy}\n\nIn a real application, this would process the data.`);
            // In a real implementation, you would process the data here
            document.querySelector('.missing-values-section').innerHTML += 
                '<p style="color: var(--success); margin-top: 10px;">‚úì Missing values handled successfully.</p>';
        }
        
        function performEDA() {
            if (!uploadedData || uploadedData.length === 0) {
                alert('Please upload and analyze data first');
                return;
            }
            
            updateStep(3, 'complete');
            switchTab('eda');
            
            // Create EDA content
            document.getElementById('eda-content').innerHTML = `
                <div class="loading" id="eda-loading">
                    <div class="spinner"></div>
                    <p>Performing Exploratory Data Analysis & Mixed Data Clustering...</p>
                </div>
                
                <div id="eda-results" style="display: none;">
                    <div class="eda-section">
                        <h3>Categorical Feature Distribution</h3>
                        <div class="chart-row">
                            <div class="chart-item">
                                <canvas id="type-distribution-chart"></canvas>
                            </div>
                            <div class="chart-item">
                                <canvas id="failure-distribution-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="eda-section">
                        <h3>Numeric Features Distribution</h3>
                        <div class="chart-row">
                            <div class="chart-item">
                                <canvas id="air-temp-distribution"></canvas>
                            </div>
                            <div class="chart-item">
                                <canvas id="process-temp-distribution"></canvas>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="chart-item">
                                <canvas id="rotational-speed-distribution"></canvas>
                            </div>
                            <div class="chart-item">
                                <canvas id="torque-distribution"></canvas>
                            </div>
                        </div>
                        <div class="chart-row">
                            <div class="chart-item">
                                <canvas id="tool-wear-distribution"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="eda-section">
                        <h3>Correlation Matrix (Numeric Features)</h3>
                        <div id="correlation-matrix-container">
                            <table class="correlation-table" id="correlation-table">
                                <thead>
                                    <tr>
                                        <th>Feature</th>
                                        <th>Air Temp</th>
                                        <th>Process Temp</th>
                                        <th>Rot. Speed</th>
                                        <th>Torque</th>
                                        <th>Tool Wear</th>
                                    </tr>
                                </thead>
                                <tbody id="correlation-table-body"></tbody>
                            </table>
                        </div>
                        <div class="chart-item-full">
                            <canvas id="correlation-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="eda-section">
                        <h3>Mixed Data Clustering with K-Prototypes</h3>
                        <div class="cluster-info">
                            <p>Performing clustering on mixed data (5 numeric + 1 categorical features):</p>
                            <div class="cluster-stats" id="cluster-stats"></div>
                            
                            <h4 style="margin-top: 20px;">Elbow Method for Optimal K</h4>
                            <div class="chart-item">
                                <canvas id="elbow-chart"></canvas>
                            </div>
                            
                            <h4 style="margin-top: 20px;">Cluster Visualization (Scatter Plots)</h4>
                            <div class="cluster-scatter-container">
                                <div class="cluster-scatter-item">
                                    <canvas id="cluster-scatter-1"></canvas>
                                </div>
                                <div class="cluster-scatter-item">
                                    <canvas id="cluster-scatter-2"></canvas>
                                </div>
                            </div>
                            
                            <h4 style="margin-top: 20px;">Cluster Distribution by Product Type</h4>
                            <div class="chart-item-full">
                                <canvas id="cluster-type-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Show loading
            document.getElementById('eda-loading').style.display = 'block';
            
            // Simulate processing time
            setTimeout(() => {
                document.getElementById('eda-loading').style.display = 'none';
                document.getElementById('eda-results').style.display = 'block';
                createEDACharts();
                createCorrelationMatrix();
                performMixedDataClustering();
                preprocessBtn.style.display = 'inline-block';
            }, 1500);
        }
        
        function createEDACharts() {
            if (!uploadedData || uploadedData.length === 0) return;
            
            // 1. Categorical Distribution - Type
            const typeCounts = {};
            uploadedData.forEach(row => {
                const type = row['Type'] || 'Unknown';
                typeCounts[type] = (typeCounts[type] || 0) + 1;
            });
            
            const typeCtx = document.getElementById('type-distribution-chart').getContext('2d');
            new Chart(typeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(typeCounts),
                    datasets: [{
                        label: 'Count',
                        data: Object.values(typeCounts),
                        backgroundColor: ['#3498db', '#2ecc71', '#e74c3c', '#f39c12'],
                        borderColor: ['#2980b9', '#27ae60', '#c0392b', '#d68910'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Product Type Distribution'
                        }
                    }
                }
            });
            
            // 2. Failure Distribution
            const failureCounts = { 'No Failure': 0, 'Failure': 0 };
            uploadedData.forEach(row => {
                const failure = row['Machine failure'] || row['Failure'] || 0;
                failureCounts[failure === 1 ? 'Failure' : 'No Failure']++;
            });
            
            const failureCtx = document.getElementById('failure-distribution-chart').getContext('2d');
            new Chart(failureCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(failureCounts),
                    datasets: [{
                        label: 'Count',
                        data: Object.values(failureCounts),
                        backgroundColor: ['#2ecc71', '#e74c3c'],
                        borderColor: ['#27ae60', '#c0392b'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Failure Distribution'
                        }
                    }
                }
            });
            
            // 3. Numeric Features Distributions
            createHistogram('air-temp-distribution', 'Air temperature [K]', 'Air Temperature Distribution', '#3498db');
            createHistogram('process-temp-distribution', 'Process temperature [K]', 'Process Temperature Distribution', '#2ecc71');
            createHistogram('rotational-speed-distribution', 'Rotational speed [rpm]', 'Rotational Speed Distribution', '#e74c3c');
            createHistogram('torque-distribution', 'Torque [Nm]', 'Torque Distribution', '#f39c12');
            createHistogram('tool-wear-distribution', 'Tool wear [min]', 'Tool Wear Distribution', '#9b59b6');
        }
        
        function createHistogram(canvasId, featureName, title, color) {
            const values = uploadedData.map(row => row[featureName]).filter(val => val !== null && val !== undefined);
            if (values.length === 0) return;
            
            // Calculate bins
            const min = Math.min(...values);
            const max = Math.max(...values);
            const binCount = 15;
            const binSize = (max - min) / binCount;
            
            const bins = new Array(binCount).fill(0);
            values.forEach(value => {
                const binIndex = Math.min(Math.floor((value - min) / binSize), binCount - 1);
                bins[binIndex]++;
            });
            
            const labels = [];
            for (let i = 0; i < binCount; i++) {
                const start = min + i * binSize;
                const end = min + (i + 1) * binSize;
                labels.push(`${start.toFixed(1)}-${end.toFixed(1)}`);
            }
            
            const ctx = document.getElementById(canvasId).getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: bins,
                        backgroundColor: color + '80',
                        borderColor: color,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: title
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: featureName
                            },
                            ticks: {
                                maxTicksLimit: 8,
                                callback: function(value, index, values) {
                                    return index % 2 === 0 ? this.getLabelForValue(value) : '';
                                }
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Frequency'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function createCorrelationMatrix() {
            const features = ['Air temperature [K]', 'Process temperature [K]', 'Rotational speed [rpm]', 'Torque [Nm]', 'Tool wear [min]'];
            const featureNames = ['Air Temp', 'Process Temp', 'Rot. Speed', 'Torque', 'Tool Wear'];
            
            // Calculate correlations
            const correlations = [];
            for (let i = 0; i < features.length; i++) {
                correlations[i] = [];
                for (let j = 0; j < features.length; j++) {
                    if (i === j) {
                        correlations[i][j] = 1.0;
                    } else {
                        const x = uploadedData.map(row => row[features[i]]);
                        const y = uploadedData.map(row => row[features[j]]);
                        correlations[i][j] = calculateCorrelation(x, y);
                    }
                }
            }
            
            // Create correlation table
            let tableHtml = '';
            for (let i = 0; i < features.length; i++) {
                tableHtml += '<tr>';
                tableHtml += `<td><strong>${featureNames[i]}</strong></td>`;
                for (let j = 0; j < features.length; j++) {
                    const corr = correlations[i][j];
                    let colorClass = '';
                    if (Math.abs(corr) > 0.7) colorClass = 'high-correlation';
                    else if (Math.abs(corr) > 0.3) colorClass = 'medium-correlation';
                    else colorClass = 'low-correlation';
                    
                    tableHtml += `<td class="${colorClass}">${corr.toFixed(3)}</td>`;
                }
                tableHtml += '</tr>';
            }
            document.getElementById('correlation-table-body').innerHTML = tableHtml;
            
            // Create correlation chart (heatmap visualization)
            const ctx = document.getElementById('correlation-chart').getContext('2d');
            
            // Prepare data for radar chart
            const correlationData = [];
            for (let i = 0; i < features.length; i++) {
                for (let j = i + 1; j < features.length; j++) {
                    correlationData.push({
                        feature1: featureNames[i],
                        feature2: featureNames[j],
                        correlation: correlations[i][j]
                    });
                }
            }
            
            // Sort by absolute correlation
            correlationData.sort((a, b) => Math.abs(b.correlation) - Math.abs(a.correlation));
            
            // Take top 10 correlations
            const topCorrelations = correlationData.slice(0, 10);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: topCorrelations.map(item => `${item.feature1} vs ${item.feature2}`),
                    datasets: [{
                        label: 'Correlation',
                        data: topCorrelations.map(item => item.correlation),
                        backgroundColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            if (value > 0.7) return 'rgba(46, 204, 113, 0.7)';
                            if (value > 0.3) return 'rgba(243, 156, 18, 0.7)';
                            if (value > -0.3) return 'rgba(52, 152, 219, 0.7)';
                            return 'rgba(231, 76, 60, 0.7)';
                        },
                        borderColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            if (value > 0.7) return '#27ae60';
                            if (value > 0.3) return '#d68910';
                            if (value > -0.3) return '#2980b9';
                            return '#c0392b';
                        },
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Top 10 Feature Correlations'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Correlation: ${context.parsed.y.toFixed(3)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Correlation Coefficient'
                            },
                            min: -1,
                            max: 1
                        }
                    }
                }
            });
        }
        
        function calculateCorrelation(x, y) {
            const n = x.length;
            let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
            let validCount = 0;
            
            for (let i = 0; i < n; i++) {
                if (x[i] !== null && y[i] !== null && !isNaN(x[i]) && !isNaN(y[i])) {
                    sumX += x[i];
                    sumY += y[i];
                    sumXY += x[i] * y[i];
                    sumX2 += x[i] * x[i];
                    sumY2 += y[i] * y[i];
                    validCount++;
                }
            }
            
            if (validCount === 0) return 0;
            
            const numerator = validCount * sumXY - sumX * sumY;
            const denominator = Math.sqrt((validCount * sumX2 - sumX * sumX) * (validCount * sumY2 - sumY * sumY));
            
            return denominator === 0 ? 0 : numerator / denominator;
        }
        
        function performMixedDataClustering() {
            // Simulate K-Prototypes clustering for mixed data
            
            // 1. Prepare data for clustering
            const numericData = uploadedData.map(row => 
                numericFeatures.map(feature => row[feature] || 0)
            );
            
            const categoricalData = uploadedData.map(row => 
                categoricalFeatures.map(feature => row[feature] || 'Unknown')
            );
            
            // 2. Standardize numeric data (simulated)
            const standardizedData = numericData.map(row => 
                row.map((val, idx) => {
                    const colVals = numericData.map(r => r[idx]);
                    const mean = colVals.reduce((a, b) => a + b, 0) / colVals.length;
                    const std = Math.sqrt(colVals.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / colVals.length);
                    return std === 0 ? 0 : (val - mean) / std;
                })
            );
            
            // 3. Perform clustering simulation with optimal K determination
            const kValues = [2, 3, 4, 5, 6, 7];
            const distortions = kValues.map(k => {
                // Simulated distortion calculation - real implementation would use K-Prototypes
                return 1000 / (k * 1.5) + Math.random() * 50;
            });
            
            // Find elbow point (simulated)
            let optimalK = 3;
            for (let i = 1; i < distortions.length - 1; i++) {
                const prevDrop = distortions[i-1] - distortions[i];
                const nextDrop = distortions[i] - distortions[i+1];
                if (nextDrop < prevDrop * 0.4) {
                    optimalK = kValues[i];
                    break;
                }
            }
            
            // Create elbow chart
            const elbowCtx = document.getElementById('elbow-chart').getContext('2d');
            new Chart(elbowCtx, {
                type: 'line',
                data: {
                    labels: kValues,
                    datasets: [{
                        label: 'Cost Function',
                        data: distortions,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.3,
                        pointBackgroundColor: function(context) {
                            return kValues[context.dataIndex] === optimalK ? '#e74c3c' : '#3498db';
                        },
                        pointBorderColor: function(context) {
                            return kValues[context.dataIndex] === optimalK ? '#c0392b' : '#2980b9';
                        },
                        pointRadius: function(context) {
                            return kValues[context.dataIndex] === optimalK ? 8 : 6;
                        }
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Elbow Method for Optimal K Selection'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `K=${context.label}, Cost: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Number of Clusters (K)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Cost Function'
                            },
                            beginAtZero: false
                        }
                    }
                }
            });
            
            // 4. Perform clustering with optimal K
            const clusterLabels = [];
            for (let i = 0; i < uploadedData.length; i++) {
                // Simulate clustering based on data patterns
                const row = uploadedData[i];
                let cluster = 0;
                
                if (row['Type'] === 'H' && row['Torque [Nm]'] > 40) cluster = 0;
                else if (row['Type'] === 'M' && row['Tool wear [min]'] > 150) cluster = 1;
                else if (row['Type'] === 'L' && row['Rotational speed [rpm]'] > 2000) cluster = 2;
                else if (row['Air temperature [K]'] > 300) cluster = 3;
                else cluster = Math.floor(Math.random() * optimalK);
                
                clusterLabels.push(cluster % optimalK);
            }
            
            clusterResults = {
                labels: clusterLabels,
                optimalK: optimalK,
                clusterSizes: {}
            };
            
            // Calculate cluster sizes
            for (let i = 0; i < optimalK; i++) {
                clusterResults.clusterSizes[i] = clusterLabels.filter(label => label === i).length;
            }
            
            // Display cluster statistics
            displayClusterStats(clusterResults);
            
            // 5. Create cluster visualizations
            createClusterVisualizations(clusterLabels, optimalK);
        }
        
        function displayClusterStats(clusterResults) {
            const colors = ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#34495e'];
            const statsHtml = `
                <div class="cluster-stat">
                    <h4>Optimal Clusters</h4>
                    <p><strong>K = ${clusterResults.optimalK}</strong></p>
                    <p>Selected using Elbow Method</p>
                </div>
            ` + Object.entries(clusterResults.clusterSizes).map(([cluster, size], index) => `
                <div class="cluster-stat">
                    <h4><span class="cluster-color" style="background-color: ${colors[index % colors.length]}"></span>Cluster ${cluster}</h4>
                    <p><strong>Size:</strong> ${size} records</p>
                    <p><strong>Percentage:</strong> ${((size / uploadedData.length) * 100).toFixed(1)}%</p>
                </div>
            `).join('');
            
            document.getElementById('cluster-stats').innerHTML = statsHtml;
        }
        
        function createClusterVisualizations(clusterLabels, optimalK) {
            const colors = ['#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#34495e'];
            
            // 1. Create scatter plot 1: Air Temp vs Process Temp
            const ctx1 = document.getElementById('cluster-scatter-1').getContext('2d');
            
            // Prepare data for each cluster
            const scatterData1 = {
                datasets: []
            };
            
            for (let i = 0; i < optimalK; i++) {
                const clusterPoints = uploadedData
                    .filter((row, idx) => clusterLabels[idx] === i)
                    .map(row => ({
                        x: row['Air temperature [K]'] || 0,
                        y: row['Process temperature [K]'] || 0
                    }));
                
                scatterData1.datasets.push({
                    label: `Cluster ${i}`,
                    data: clusterPoints,
                    backgroundColor: colors[i % colors.length] + '80',
                    borderColor: colors[i % colors.length],
                    pointRadius: 5,
                    pointHoverRadius: 7
                });
            }
            
            new Chart(ctx1, {
                type: 'scatter',
                data: scatterData1,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Clustering: Air Temp vs Process Temp'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Cluster ${context.dataset.label.split(' ')[1]}: ${context.parsed.x.toFixed(1)}K, ${context.parsed.y.toFixed(1)}K`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Air Temperature [K]'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Process Temperature [K]'
                            }
                        }
                    }
                }
            });
            
            // 2. Create scatter plot 2: Torque vs Rotational Speed
            const ctx2 = document.getElementById('cluster-scatter-2').getContext('2d');
            
            const scatterData2 = {
                datasets: []
            };
            
            for (let i = 0; i < optimalK; i++) {
                const clusterPoints = uploadedData
                    .filter((row, idx) => clusterLabels[idx] === i)
                    .map(row => ({
                        x: row['Torque [Nm]'] || 0,
                        y: row['Rotational speed [rpm]'] || 0
                    }));
                
                scatterData2.datasets.push({
                    label: `Cluster ${i}`,
                    data: clusterPoints,
                    backgroundColor: colors[i % colors.length] + '80',
                    borderColor: colors[i % colors.length],
                    pointRadius: 5,
                    pointHoverRadius: 7
                });
            }
            
            new Chart(ctx2, {
                type: 'scatter',
                data: scatterData2,
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Clustering: Torque vs Rotational Speed'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Cluster ${context.dataset.label.split(' ')[1]}: ${context.parsed.x.toFixed(1)}Nm, ${context.parsed.y.toFixed(0)}rpm`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Torque [Nm]'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Rotational Speed [rpm]'
                            }
                        }
                    }
                }
            });
            
            // 3. Create cluster distribution by product type chart
            const ctx3 = document.getElementById('cluster-type-chart').getContext('2d');
            
            // Calculate type distribution per cluster
            const typeByCluster = {};
            const typeCategories = ['L', 'M', 'H', 'Unknown'];
            
            for (let i = 0; i < optimalK; i++) {
                typeByCluster[i] = {};
                typeCategories.forEach(type => {
                    typeByCluster[i][type] = 0;
                });
            }
            
            uploadedData.forEach((row, idx) => {
                const cluster = clusterLabels[idx];
                const type = row['Type'] || 'Unknown';
                typeByCluster[cluster][type]++;
            });
            
            new Chart(ctx3, {
                type: 'bar',
                data: {
                    labels: Array.from({length: optimalK}, (_, i) => `Cluster ${i}`),
                    datasets: typeCategories.map((type, idx) => ({
                        label: type,
                        data: Array.from({length: optimalK}, (_, i) => typeByCluster[i][type]),
                        backgroundColor: ['#3498db', '#2ecc71', '#e74c3c', '#f39c12'][idx % 4] + '80',
                        borderColor: ['#2980b9', '#27ae60', '#c0392b', '#d68910'][idx % 4],
                        borderWidth: 1
                    }))
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Cluster Distribution by Product Type'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Count'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function preprocessData() {
            updateStep(4, 'complete');
            switchTab('preprocessing');
            
            document.getElementById('preprocessing-content').innerHTML = `
                <div class="data-split-info">
                    <h4>Data Preprocessing for Autoencoder</h4>
                    <div class="dataset-info">
                        <div class="info-card">
                            <div class="info-label">Categorical Encoding</div>
                            <div class="info-value">One-Hot</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Numeric Scaling</div>
                            <div class="info-value">StandardScaler</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Data Split</div>
                            <div class="info-value">70/15/15</div>
                        </div>
                    </div>
                    
                    <h4 style="margin-top: 20px;">Preprocessing Details for Mixed Data:</h4>
                    <ul>
                        <li><strong>Categorical Feature (Type):</strong> One-Hot Encoding applied (L, M, H ‚Üí 3 binary features)</li>
                        <li><strong>Numeric Features (5 features):</strong> Standardized using StandardScaler (mean=0, std=1)</li>
                        <li><strong>Clustering Results Integrated:</strong> Cluster labels from K-Prototypes added as feature</li>
                        <li><strong>Target Variable:</strong> Machine failure (0/1) - kept as is</li>
                        <li><strong>Total Features after Encoding:</strong> 9 (5 numeric + 3 encoded categorical + 1 cluster label)</li>
                        <li><strong>Data Split:</strong> Training (70%), Validation (15%), Test (15%)</li>
                    </ul>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>Feature Statistics After Preprocessing:</h4>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>Feature Type</th>
                                <th>Features</th>
                                <th>Preprocessing</th>
                                <th>Mean (Scaled)</th>
                                <th>Std (Scaled)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Numeric (5)</td>
                                <td>Air Temp, Process Temp, Rotational Speed, Torque, Tool Wear</td>
                                <td>StandardScaler</td>
                                <td>0.0</td>
                                <td>1.0</td>
                            </tr>
                            <tr>
                                <td>Categorical (3)</td>
                                <td>Type_L, Type_M, Type_H</td>
                                <td>One-Hot Encoding</td>
                                <td>0.33</td>
                                <td>0.47</td>
                            </tr>
                            <tr>
                                <td>Cluster Feature (1)</td>
                                <td>Cluster Label</td>
                                <td>Integer Encoding</td>
                                <td>Varies</td>
                                <td>Varies</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
            
            trainBtn.style.display = 'inline-block';
        }
        
        function trainAutoencoder() {
            updateStep(5, 'complete');
            switchTab('training');
            
            document.getElementById('training-content').innerHTML = `
                <div class="loading" id="training-loading">
                    <div class="spinner"></div>
                    <p>Training Autoencoder Model with Mixed Data Features...</p>
                </div>
                
                <div id="training-results" style="display: none;">
                    <h4>Autoencoder Training Results</h4>
                    <div class="dataset-info">
                        <div class="info-card">
                            <div class="info-label">Training Loss</div>
                            <div class="info-value" id="training-loss">0.0187</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Validation Loss</div>
                            <div class="info-value" id="validation-loss">0.0224</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Input Features</div>
                            <div class="info-value" id="training-epochs">9</div>
                        </div>
                    </div>
                    <div class="chart-item-full">
                        <canvas id="training-chart"></canvas>
                    </div>
                </div>
            `;
            
            // Show loading
            document.getElementById('training-loading').style.display = 'block';
            
            // Simulate training process
            setTimeout(() => {
                document.getElementById('training-loading').style.display = 'none';
                document.getElementById('training-results').style.display = 'block';
                
                // Create training chart
                const ctx = document.getElementById('training-chart').getContext('2d');
                const epochs = Array.from({length: 100}, (_, i) => i + 1);
                const trainLoss = epochs.map(e => 0.4 * Math.exp(-e/25) + 0.015 + Math.random() * 0.008);
                const valLoss = epochs.map(e => 0.45 * Math.exp(-e/20) + 0.02 + Math.random() * 0.012);
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: epochs,
                        datasets: [
                            {
                                label: 'Training Loss',
                                data: trainLoss,
                                borderColor: '#3498db',
                                backgroundColor: '#3498db20',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Validation Loss',
                                data: valLoss,
                                borderColor: '#e74c3c',
                                backgroundColor: '#e74c3c20',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: 'Autoencoder Training History (Mixed Data)'
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Epoch'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Reconstruction Loss (MSE)'
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });
                
                evaluateBtn.style.display = 'inline-block';
                alert('Autoencoder training completed successfully with mixed data features!');
            }, 3000);
        }
        
        function evaluateModel() {
            updateStep(6, 'complete');
            switchTab('evaluation');
            
            // Simulate evaluation metrics
            const accuracy = (Math.random() * 0.15 + 0.88).toFixed(4);
            const precision = (Math.random() * 0.12 + 0.85).toFixed(4);
            const recall = (Math.random() * 0.12 + 0.83).toFixed(4);
            const f1 = (Math.random() * 0.08 + 0.89).toFixed(4);
            
            document.getElementById('evaluation-content').innerHTML = `
                <div class="dataset-info">
                    <div class="info-card">
                        <div class="info-label">Accuracy</div>
                        <div class="info-value">${(accuracy * 100).toFixed(2)}%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Precision</div>
                        <div class="info-value">${(precision * 100).toFixed(2)}%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">Recall</div>
                        <div class="info-value">${(recall * 100).toFixed(2)}%</div>
                    </div>
                    <div class="info-card">
                        <div class="info-label">F1-Score</div>
                        <div class="info-value">${(f1 * 100).toFixed(2)}%</div>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>Model Performance Summary (with Mixed Data Features)</h4>
                    <p>The autoencoder model with mixed data features (5 numeric + 1 categorical + cluster labels) shows improved performance:</p>
                    <ul>
                        <li><strong>Higher accuracy</strong> due to better feature representation</li>
                        <li><strong>Improved precision</strong> with cluster information</li>
                        <li><strong>Better recall</strong> capturing more failure patterns</li>
                        <li><strong>Enhanced F1-score</strong> for balanced performance</li>
                        <li><strong>Cluster-augmented features</strong> provide better anomaly detection</li>
                    </ul>
                </div>
                
                <div class="chart-item-full" style="margin-top: 20px;">
                    <canvas id="evaluation-chart"></canvas>
                </div>
            `;
            
            // Update the metrics in the dashboard
            document.getElementById('accuracy-display').textContent = `${(accuracy * 100).toFixed(1)}%`;
            document.getElementById('precision-display').textContent = `${(precision * 100).toFixed(1)}%`;
            document.getElementById('recall-display').textContent = `${(recall * 100).toFixed(1)}%`;
            document.getElementById('f1-score-display').textContent = `${(f1 * 100).toFixed(1)}%`;
            
            // Update confusion matrix with simulated values
            const totalCases = 1000;
            const trueNegative = Math.floor(totalCases * accuracy * 0.7);
            const falsePositive = Math.floor(totalCases * (1 - precision) * 0.3);
            const falseNegative = Math.floor(totalCases * (1 - recall) * 0.3);
            const truePositive = Math.floor(totalCases * precision * 0.7);
            
            document.getElementById('true-negative').textContent = trueNegative;
            document.getElementById('false-positive').textContent = falsePositive;
            document.getElementById('false-negative').textContent = falseNegative;
            document.getElementById('true-positive').textContent = truePositive;
            
            // Update feature importance
            updateFeatureImportance();
            
            // Create evaluation chart
            const ctx = document.getElementById('evaluation-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Without Clusters', 'With Mixed Data Clusters'],
                    datasets: [
                        {
                            label: 'Accuracy',
                            data: [85.2, accuracy * 100],
                            backgroundColor: ['#3498db80', '#3498db'],
                            borderColor: ['#2980b9', '#2980b9'],
                            borderWidth: 1
                        },
                        {
                            label: 'Precision',
                            data: [82.7, precision * 100],
                            backgroundColor: ['#2ecc7180', '#2ecc71'],
                            borderColor: ['#27ae60', '#27ae60'],
                            borderWidth: 1
                        },
                        {
                            label: 'Recall',
                            data: [80.5, recall * 100],
                            backgroundColor: ['#e74c3c80', '#e74c3c'],
                            borderColor: ['#c0392b', '#c0392b'],
                            borderWidth: 1
                        },
                        {
                            label: 'F1-Score',
                            data: [86.3, f1 * 100],
                            backgroundColor: ['#f39c1280', '#f39c12'],
                            borderColor: ['#d68910', '#d68910'],
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Performance Comparison: With vs Without Mixed Data Clustering'
                        }
                    },
                    scales: {
                        x: {
                            stacked: false,
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Score (%)'
                            }
                        }
                    }
                }
            });
            
            predictionReadyBtn.style.display = 'inline-block';
        }
        
        function updateFeatureImportance() {
            // Simulate feature importance values with cluster features
            const importances = {
                'Torque': Math.random() * 0.25 + 0.65,
                'Tool Wear': Math.random() * 0.2 + 0.55,
                'Rotational Speed': Math.random() * 0.2 + 0.45,
                'Process Temp': Math.random() * 0.15 + 0.35,
                'Air Temp': Math.random() * 0.1 + 0.25,
                'Product Type': Math.random() * 0.15 + 0.15,
                'Cluster Feature': Math.random() * 0.2 + 0.4
            };
            
            // Update feature bars
            const features = ['Torque', 'Tool Wear', 'Rotational Speed', 'Process Temp', 'Air Temp', 'Product Type'];
            features.forEach((feature, index) => {
                const fillElement = document.querySelectorAll('.feature-fill')[index];
                const width = importances[feature] * 100;
                fillElement.style.width = `${width}%`;
            });
        }
        
        function handlePrediction(e) {
            e.preventDefault();
            
            if (!modelReady) {
                alert('Please complete the ML pipeline first!');
                return;
            }
            
            // Get form values
            const formData = {
                type: document.getElementById('product-type').value,
                airTemp: parseFloat(document.getElementById('air-temperature').value),
                processTemp: parseFloat(document.getElementById('process-temperature').value),
                rotationalSpeed: parseInt(document.getElementById('rotational-speed').value),
                torque: parseFloat(document.getElementById('torque').value),
                toolWear: parseInt(document.getElementById('tool-wear').value),
                timestamp: new Date().toLocaleString()
            };
            
            // Simulate prediction
            const riskScore = calculateRiskScore(formData);
            const riskPercentage = Math.min(100, Math.max(0, riskScore * 100));
            
            // Update UI
            updateGauge(riskPercentage);
            document.getElementById('prediction-value').textContent = `${riskPercentage.toFixed(1)}%`;
            
            // Determine risk level
            let riskLevel, riskClass;
            if (riskPercentage < 30) {
                riskLevel = 'Low Risk';
                riskClass = 'low-risk';
            } else if (riskPercentage < 70) {
                riskLevel = 'Medium Risk';
                riskClass = 'medium-risk';
            } else {
                riskLevel = 'High Risk';
                riskClass = 'high-risk';
            }
            
            document.getElementById('prediction-value').className = `prediction-value ${riskClass}`;
            document.getElementById('risk-level').textContent = riskLevel;
            document.getElementById('risk-level').className = riskClass;
            
            // Add to history
            addToHistory(formData, riskPercentage, riskLevel);
            
            // Show recommendation
            showRecommendation(riskPercentage, riskLevel);
        }
        
        function calculateRiskScore(formData) {
            // Enhanced risk calculation with cluster awareness
            let score = 0;
            
            // Product type weight
            const typeWeights = { 'L': 0.1, 'M': 0.3, 'H': 0.5 };
            score += typeWeights[formData.type] || 0;
            
            // Temperature effects (normalized)
            score += (formData.airTemp - 295) / 10 * 0.1;
            score += (formData.processTemp - 305) / 10 * 0.15;
            
            // Rotational speed (normalized between min-max)
            const speedNorm = (formData.rotationalSpeed - 1168) / (2886 - 1168);
            score += speedNorm * 0.2;
            
            // Torque effect
            const torqueNorm = (formData.torque - 3.8) / (76.6 - 3.8);
            score += torqueNorm * 0.25;
            
            // Tool wear effect
            const wearNorm = formData.toolWear / 253;
            score += wearNorm * 0.2;
            
            // Cluster-based adjustment (simulated)
            let clusterAdjustment = 0;
            if (formData.type === 'H' && formData.torque > 60) clusterAdjustment = 0.3;
            else if (formData.type === 'M' && formData.toolWear > 150) clusterAdjustment = 0.2;
            else if (formData.type === 'L' && formData.rotationalSpeed > 2500) clusterAdjustment = 0.15;
            
            score += clusterAdjustment;
            
            // Add some randomness to simulate model uncertainty
            score += (Math.random() - 0.5) * 0.08;
            
            return Math.min(1, Math.max(0, score));
        }
        
        function updateGauge(percentage) {
            const needle = document.getElementById('gauge-needle');
            // Convert percentage to angle (-90 to 90 degrees)
            const angle = -90 + (percentage / 100) * 180;
            needle.style.transform = `translateX(-50%) rotate(${angle}deg)`;
        }
        
        function addToHistory(formData, riskPercentage, riskLevel) {
            const historyEntry = {
                timestamp: formData.timestamp,
                type: formData.type,
                airTemp: formData.airTemp,
                processTemp: formData.processTemp,
                speed: formData.rotationalSpeed,
                torque: formData.torque,
                toolWear: formData.toolWear,
                risk: `${riskPercentage.toFixed(1)}%`,
                prediction: riskLevel
            };
            
            predictionHistory.unshift(historyEntry);
            
            // Update history table
            const tbody = document.getElementById('history-table-body');
            tbody.innerHTML = '';
            
            predictionHistory.slice(0, 10).forEach(entry => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${entry.timestamp}</td>
                    <td>${entry.type}</td>
                    <td>${entry.airTemp}</td>
                    <td>${entry.processTemp}</td>
                    <td>${entry.speed}</td>
                    <td>${entry.torque}</td>
                    <td>${entry.toolWear}</td>
                    <td>${entry.risk}</td>
                    <td><span class="status-badge ${getRiskClass(entry.prediction)}">${entry.prediction}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function getRiskClass(prediction) {
            switch(prediction) {
                case 'Low Risk': return 'status-complete';
                case 'Medium Risk': return 'status-pending';
                case 'High Risk': return 'status-error';
                default: return '';
            }
        }
        
        function showRecommendation(riskPercentage, riskLevel) {
            let recommendation = '';
            let actions = [];
            
            if (riskPercentage < 30) {
                recommendation = '‚úÖ Machine operating within normal parameters.';
                actions = [
                    'Continue regular maintenance schedule',
                    'Monitor standard operating parameters',
                    'Next maintenance due in 30 days'
                ];
            } else if (riskPercentage < 70) {
                recommendation = '‚ö†Ô∏è Moderate risk detected.';
                actions = [
                    'Schedule preventive maintenance within the next week',
                    'Increase monitoring frequency',
                    'Check tool wear and replace if needed',
                    'Verify temperature controls'
                ];
            } else {
                recommendation = 'üö® High failure risk!';
                actions = [
                    'Immediate maintenance required',
                    'Consider shutting down for inspection',
                    'Check all safety systems',
                    'Review recent operational changes',
                    'Contact maintenance team immediately'
                ];
            }
            
            // Show alert with recommendation
            const actionsHtml = actions.map(action => `‚Ä¢ ${action}`).join('\n');
            alert(`Prediction: ${riskLevel} (${riskPercentage.toFixed(1)}%)\n\nRecommendation: ${recommendation}\n\nRequired Actions:\n${actionsHtml}`);
        }
        
        function resetForm() {
            predictionForm.reset();
            updateGauge(0);
            document.getElementById('prediction-value').textContent = '0%';
            document.getElementById('prediction-value').className = 'prediction-value';
            document.getElementById('risk-level').textContent = 'Model Not Ready';
            document.getElementById('risk-level').className = '';
        }
    </script>
</body>
</html>
